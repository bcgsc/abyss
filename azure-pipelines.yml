jobs:  
- job: macos_clang15
  pool:
    vmImage: 'macOS-latest'
  steps:
  - script: |
      set -o errexit -o pipefail
      brew update
      brew reinstall llvm@15 pandoc google-sparsehash boost make automake openmpi perl pandoc ghc cmake meson ninja
    displayName: Install common
  - script: |
      wget https://github.com/bcgsc/btllib/releases/download/v1.4.9/btllib-1.4.9.tar.gz
      tar xzf btllib-1.4.9.tar.gz
      cd btllib-1.4.9
      export CC=clang
      export CXX=clang++
      ./compile
    displayName: Install btllib
  - script: |
      export CC=clang
      export CXX=clang++
      ./autogen.sh
      export DISTCHECK_CONFIGURE_FLAGS="CC=clang CXX=clang++ --with-btllib=/Users/runner/work/1/s/btllib-1.4.9/install"
      ./configure CC=clang CXX=clang++ --with-btllib=/Users/runner/work/1/s/btllib-1.4.9/install
      make -j12 distcheck
    displayName: Compiling ABySS with clang 15

- job: macos_clang14
  pool:
    vmImage: 'macOS-latest'
  steps:
  - script: |
      set -o errexit -o pipefail
      brew update
      brew reinstall llvm@14 pandoc google-sparsehash boost make automake openmpi perl pandoc ghc cmake meson ninja
      export PATH="$(brew --prefix llvm@14)/bin:$PATH"
      ls /usr/local/bin
    displayName: Install common
  - script: |
      wget https://github.com/bcgsc/btllib/releases/download/v1.4.9/btllib-1.4.9.tar.gz
      tar xzf btllib-1.4.9.tar.gz
      cd btllib-1.4.9
      export PATH="/usr/local/opt/llvm@14/bin:/usr/local/bin:$PATH"
      export LIBRARY_PATH=/usr/local/lib:$LIBRARY_PATH
      export LD_LIBRARY_PATH=/usr/local/lib:$LD_LIBRARY_PATH
      export CC=clang
      export CXX=clang++
      ./compile
    displayName: Install btllib
  - script: |
      export PATH=/usr/local/opt/llvm@14/bin:/usr/local/bin:$PATH
      export LIBRARY_PATH=/usr/local/lib:$LIBRARY_PATH
      export LD_LIBRARY_PATH=/usr/local/lib:$LD_LIBRARY_PATH
      export CC=clang
      export CXX=clang++
      ./autogen.sh
      export DISTCHECK_CONFIGURE_FLAGS="CC=clang CXX=clang++ --with-btllib=/Users/runner/work/1/s/btllib-1.4.9/install"
      ./configure CC=clang CXX=clang++ --with-btllib=/Users/runner/work/1/s/btllib-1.4.9/install
      make -j12 distcheck
    displayName: Compiling ABySS with clang 14
