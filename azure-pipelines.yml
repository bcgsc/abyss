jobs:
- job: linux_gcc8_32bit
  pool:
    vmImage: ubuntu-latest
  steps:
  - script: |
      sudo apt-get update -qq
      sudo apt-get install -qq software-properties-common
      sudo add-apt-repository -y "deb http://us.archive.ubuntu.com/ubuntu bionic main universe restricted"
      sudo add-apt-repository -y "deb http://us.archive.ubuntu.com/ubuntu bionic-updates main universe restricted"
      sudo apt-get update -qq
      sudo apt-get install -qq autoconf automake gcc g++ libboost-dev libgtest-dev libopenmpi-dev libsparsehash-dev make pandoc cmake meson
    displayName: Install common
  - script: sudo apt-get install -qq gcc-8 g++-8
    displayName: Install gcc-8
  - script: sudo apt-get install gcc-8-multilib g++-8-multilib
    displayName: Install 32-bit compilation support
  - script: |
      wget https://github.com/bcgsc/btllib/releases/download/v1.4.9/btllib-1.4.9.tar.gz
      tar xzf btllib-1.4.9.tar.gz
      cd btllib-1.4.9
      ./compile
    displayName: Install btllib
  - script: |
      ./autogen.sh
      export DISTCHECK_CONFIGURE_FLAGS="CC=\"gcc-8 -m32\" CXX=\"g++-8 -m32\" --build=i386-linux-gnu"
      ./configure CC=gcc-8 CXX=g++-8 --build=i686-linux-gnu "CFLAGS=-m32" "CXXFLAGS=-m32" "LDFLAGS=-m32" --with-mpi=/usr/lib/openmpi --with-btllib=./btllib-1.4.9/install
      make -j12 distcheck
    displayName: Compiling ABySS with gcc-8

