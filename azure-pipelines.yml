jobs:  
- job: macos_clang15
  pool:
    vmImage: 'macOS-latest'
  steps:
  - script: |
      set -o errexit -o pipefail
      brew update
      brew reinstall llvm@15 pandoc google-sparsehash boost make automake openmpi perl pandoc ghc cmake meson ninja
    displayName: Install common
  - script: |
      wget https://github.com/bcgsc/btllib/releases/download/v1.4.9/btllib-1.4.9.tar.gz
      tar xzf btllib-1.4.9.tar.gz
      cd btllib-1.4.9
      export CC=clang
      export CXX=clang++
      ./compile
    displayName: Install btllib
  - script: |
      export CC=clang
      export CXX=clang++
      ./autogen.sh
      export DISTCHECK_CONFIGURE_FLAGS="CC=clang CXX=clang++ --with-btllib=/Users/runner/work/1/s/btllib-1.4.9/install"
      ./configure CC=clang CXX=clang++ --with-btllib=/Users/runner/work/1/s/btllib-1.4.9/install
      make -j12 distcheck
    displayName: Compiling ABySS with clang 15

- job:
  displayName: mac-latest-compilers-13
  pool:
    vmImage: 'macOS-latest'
  steps:
  - script: echo "##vso[task.prependpath]$CONDA/bin"
    displayName: Add conda to PATH
  - script: conda create --yes --quiet --name abyss_CI
    displayName: Create Anaconda environment
  - script: |
      source activate abyss_CI
      conda install --yes -c conda-forge mamba python=3.9
      mamba install --yes -c conda-forge -c bioconda compilers=1.4.2 make boost-cpp sparsehash openmpi automake perl btllib pandoc
    displayName: Install dependencies
  - script: |
      source activate abyss_CI
      ./autogen.sh
      ./configure
      make -j12 distcheck
    displayName: Compiling ABySS

- job:
  displayName: mac-latest-compilers-13
  pool:
    vmImage: 'macOS-latest'
  steps:
  - script: echo "##vso[task.prependpath]$CONDA/bin"
    displayName: Add conda to PATH
  - script: conda create --yes --quiet --name abyss_CI
    displayName: Create Anaconda environment
  - script: |
      source activate abyss_CI
      conda install --yes -c conda-forge mamba python=3.9
      mamba install --yes -c conda-forge -c bioconda compilers=1.3.0 make boost-cpp sparsehash openmpi automake perl btllib pandoc
    displayName: Install dependencies
  - script: |
      source activate abyss_CI
      ./autogen.sh
      ./configure
      make -j12 distcheck
    displayName: Compiling ABySS
