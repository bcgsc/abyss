jobs:  
- job:
  displayName: linux_gcc-latest
  pool:
    vmImage: 'ubuntu-latest'
  steps:
  - script: echo "##vso[task.prependpath]$CONDA/bin"
    displayName: Add conda to PATH
  - script: conda create --yes --quiet --name abyss_CI
    displayName: Create Anaconda environment
  - script: |
      source activate abyss_CI
      conda install --yes -c conda-forge mamba python=3.9
      mamba install --yes -c conda-forge -c bioconda compilers make boost-cpp sparsehash openmpi util-linux perl btllib pandoc
    displayName: Install dependencies
  - script: |
      source activate abyss_CI
      ./autogen.sh
      export CFLAGS="$CFLAGS -flto=4 -Werror=odr -Werror=lto-type-mismatch -Werror=strict-aliasing"
      export CXXFLAGS="$CXXFLAGS -flto=4 -Werror=odr -Werror=lto-type-mismatch -Werror=strict-aliasing"
      export CPPFLAGS="$CPPFLAGS -flto=4 -Werror=odr -Werror=lto-type-mismatch -Werror=strict-aliasing"
      ./configure
      make -j12 distcheck AM_CXXFLAGS=-Wall CXXFLAGS='-pthread'
    displayName: Compiling ABySS with gcc
